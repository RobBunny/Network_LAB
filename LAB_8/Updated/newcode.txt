Updated code with timeout and triple acks
